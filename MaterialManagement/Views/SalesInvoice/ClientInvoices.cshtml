@model MaterialManagement.BLL.ModelVM.Client.ClientViewModel

@{
    ViewData["Title"] = $"فواتير العميل: {Model.Name}";
}

<h2 class="mb-3">🧾 فواتير العميل: <span class="text-primary">@Model.Name</span></h2>
<p><a asp-action="Index" class="btn btn-secondary">العودة لقائمة العملاء</a></p>

<div class="card shadow-sm">
    <div class="card-body">
        <table id="invoicesTable" class="table table-bordered table-hover" style="width:100%">
            <thead class="table-dark">
                <tr>
                    <th>رقم الفاتورة</th>
                    <th>التاريخ</th>
                    <th>الإجمالي</th>
                    <th>المدفوع</th>
                    <th>المتبقي</th>
                    <th>إجراءات</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#invoicesTable').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "/SalesInvoice/LoadClientInvoices",
                    "type": "POST",
                    "data": function (d) {
                        // إرسال رقم العميل مع كل طلب
                        d.clientId = @Model.Id;
                    }
                },
                "columns": [
                    { "data": "invoiceNumber" },
                    {
                        "data": "invoiceDate",
                        "render": function(data) { return new Date(data).toLocaleDateString('ar-EG'); }
                    },
                    { "data": "totalAmount", "render": $.fn.dataTable.render.number(',', '.', 2) },
                    { "data": "paidAmount", "render": $.fn.dataTable.render.number(',', '.', 2) },
                    {
                        "data": "remainingAmount",
                        "render": function(data) {
                            return data > 0 ? `<span class="badge bg-danger">${$.fn.dataTable.render.number(',', '.', 2).display(data)}</span>` : `<span class="badge bg-success">✔</span>`;
                        }
                    },
                    {
                        "data": "id",
                        "render": function (data) {
                            return `<a href='/SalesInvoice/Details/${data}' class='btn btn-info btn-sm'>👁</a> ` +
                                   `<a href='/SalesInvoice/Delete/${data}' class='btn btn-danger btn-sm'>🗑</a>`;
                        },
                        "orderable": false
                    }
                ],
                "language": { "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/Arabic.json" },
                "order": [[ 1, "desc" ]]
            });
        });
    </script>
}