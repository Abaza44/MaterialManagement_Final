@model MaterialManagement.BLL.ModelVM.Reservation.ReservationFulfillmentViewModel

@{
    ViewData["Title"] = $"تسليم جزئي للحجز #{Model.ReservationNumber}";
}

<div class="card shadow-sm border-0">
    <div class="card-body p-4">

        <h1 class="mb-3"><i class="bi bi-truck text-primary"></i> @ViewData["Title"]</h1>
        <hr />

        <div class="alert alert-info">
            <strong>العميل:</strong> @Model.ClientName
        </div>

        <form asp-action="Fulfill" asp-route-id="@Model.ReservationId" method="post">
            <input type="hidden" asp-for="ReservationId" />

            <div asp-validation-summary="All" class="text-danger mb-3"></div>

            <h4>الأصناف المتبقية للتسليم:</h4>
            <table class="table table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>المادة</th>
                        <th>محجوز كليًا</th>
                        <th>تم التسليم سابقاً</th>
                        <th class="text-info">متبقي للتسليم</th>
                        <th class="text-danger" style="width: 20%;">الكمية للتسليم الآن</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.ItemsToFulfill.Count; i++)
                    {
                        var item = Model.ItemsToFulfill[i];

                        // لا داعي للـ if هنا، لأن الكنترولر (GET) قام بفلترتها مسبقاً
                        <tr>
                            <td>
                                @item.MaterialName
                                <input type="hidden" asp-for="ItemsToFulfill[i].ReservationItemId" />
                            </td>
                            <td>@item.QuantityReserved</td>
                            <td>@item.QuantityFulfilled</td>
                            <td class="fw-bold text-info">@item.QuantityRemaining</td>

                            <td>
                                <input type="number"
                                       asp-for="ItemsToFulfill[i].QuantityToFulfillNow"
                                       class="form-control form-control-sm"
                                       min="0"
                                       max="@item.QuantityRemaining"
                                       step="0.01"
                                       value="0" />

                                <span asp-validation-for="ItemsToFulfill[i].QuantityToFulfillNow" class="text-danger"></span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <button type="submit" class="btn btn-success btn-lg mt-3">
                <i class="bi bi-check-circle"></i> تأكيد التسليم الجزئي
            </button>
            <a asp-action="Details" asp-route-id="@Model.ReservationId" class="btn btn-secondary mt-3">إلغاء</a>
        </form>

    </div>
</div>