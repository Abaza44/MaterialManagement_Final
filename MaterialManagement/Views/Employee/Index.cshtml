@{
    ViewData["Title"] = "إدارة الموظفين";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1><i class="bi bi-people-fill"></i> @ViewData["Title"]</h1>
    <a asp-action="Create" class="btn btn-success">
        <i class="bi bi-person-plus"></i> إضافة موظف جديد
    </a>
</div>

<div class="card shadow-sm">
    <div class="card-header">
        <h5 class="mb-0">قائمة الموظفين</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle" id="employeesTable">
                <thead class="table-light">
                    <tr>
                        <th>الاسم</th>
                        <th>الوظيفة</th>
                        <th>رقم الهاتف</th>
                        <th>الراتب</th>
                        <th>تاريخ التعيين</th>
                        <th>الحالة</th>
                        <th class="text-center">العمليات</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#employeesTable').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "/Employee/LoadData", 
                    "type": "POST"
                },
                "columns": [
                    { "data": "name" },
                    { "data": "position", "defaultContent": "---" },
                    { "data": "phone" },
                    {
                        "data": "salary",
                        "render": function(data) {
                            return new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'EGP' }).format(data);
                        }
                    },
                    {
                        "data": "hireDate",
                        "render": function(data) {
                            return new Date(data).toLocaleDateString('ar-EG');
                        }
                    },
                    {
                        "data": "isActive",
                        "render": function(data) {
                            return data ? '<span class="badge bg-success">نشط</span>' : '<span class="badge bg-danger">غير نشط</span>';
                        }
                    },
                    {
                        "data": "id",
                        "render": function (data, type, row) {
                            let editButton = `<a href='/Employee/Edit/${data}' class='btn btn-outline-warning btn-sm' title='تعديل'><i class='bi bi-pencil'></i></a>`;
                            let actionButton = row.isActive
                                ? `<form asp-action="Delete" asp-route-id="${data}" method="post" onsubmit="return confirm('هل أنت متأكد من تعطيل هذا الموظف؟');" style="display:inline;"> @Html.AntiForgeryToken() <button type="submit" class="btn btn-outline-danger btn-sm" title="تعطيل"><i class="bi bi-person-x"></i></button></form>`
                                : ''; 

                            return `<div class="btn-group btn-group-sm">${editButton} ${actionButton}</div>`;
                        },
                        "orderable": false,
                        "searchable": false
                    }
                ],
                "language": { "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/Arabic.json" }
            });
        });
    </script>
}